{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["import React from 'react';\r\nimport _ from 'lodash';\r\nconst getIndex = (list, item) => {\r\n  if (list && list.length < 1) {\r\n    return 0;\r\n  }\r\n  let index1 = _.findIndex(list, item);\r\n  let index2 = list.indexOf(item);\r\n  let index = Math.max(index1, index2);\r\n  if (index < 0) {\r\n    throw new Error('list数组中不存在defaultValue');\r\n  }\r\n  return index;\r\n}\r\n\r\nclass Picker extends React.Component {\r\n  constructor(props) {\r\n    super();\r\n    this.props = props;\r\n    this.startY = 0;\r\n    this.endY   = 0;\r\n    //当前拖动的Y坐标\r\n    this.currentY = 0;\r\n    this.itemHeight = 35;\r\n    this.selectedIndex = this.getInitialIndex();\r\n    this.state = {style: {}};\r\n    this._defaultValue = null;\r\n  }\r\n\r\n  // 初始化获得selectedIndex\r\n  getInitialIndex() {\r\n    let index = getIndex(\r\n      this.props.data.list,\r\n      this.props.data.defaultValue\r\n    );\r\n    if (!this.props.data.defaultValue && this.props.data.list.length > 3) {\r\n      index = Math.floor(this.props.data.list.length / 2);\r\n    }\r\n    return index;\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    const isEqual = _.isEqual(\r\n      nextProps.data.defaultValue,\r\n      this._defaultValue\r\n    );\r\n    if (!isEqual) {\r\n      this._defaultValue = nextProps.data.defaultValue;\r\n      this.selectedIndex = this.getReceivePropsIndex(nextProps.data);\r\n      if (this.selectedIndex === 0) {\r\n        this.state = {\r\n          style: {\r\n            transform: `translate3d(0px, ${this.itemHeight * 2}px, 0px)`\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getReceivePropsIndex (data) {\r\n    if (this._defaultValue) {\r\n      this.selectedIndex = getIndex(\r\n        data.list,\r\n        data.defaultValue\r\n      );\r\n    }\r\n    return this.selectedIndex;\r\n  }\r\n\r\n  getInitialStyle () {\r\n    this.currentY = 0;\r\n    if (this.selectedIndex > 2) {\r\n      this.currentY = - (this.selectedIndex - 2) * this.itemHeight;\r\n    } else {\r\n      this.currentY = (2 - this.selectedIndex) * this.itemHeight;\r\n    }\r\n    return `translate3d(0px, ${ this.currentY }px, 0px)`;\r\n  }\r\n\r\n  handleTouchStart (e) {\r\n\r\n    if (this.props.data.list.length <= 1) {\r\n      return;\r\n    }\r\n    this.startY = e.nativeEvent.changedTouches[0].pageY;\r\n  }\r\n\r\n  handleTouchEnd (e) {\r\n\r\n    if (this.props.data.list.length <= 1) {\r\n      return;\r\n    }\r\n    this.endY = e.nativeEvent.changedTouches[0].pageY;\r\n    // 实际滚动距离\r\n    let v = parseInt(this.endY - this.startY);\r\n    let value = v % this.itemHeight;\r\n    // 计算出每次拖动的36px整倍数\r\n    this.currentY += (v - value);\r\n\r\n    // 正数y最大值\r\n    const max1 = 2 * this.itemHeight;\r\n    // 负数y最小值\r\n    const max2 = (this.props.data.list.length - 3) * this.itemHeight;\r\n\r\n    if (this.currentY > max1) {\r\n      this.currentY = max1;\r\n    }\r\n    else if (this.currentY > 0 && this.currentY < max1) {\r\n      this.currentY = this.currentY;\r\n    }\r\n    else if (this.currentY === max1) {\r\n      this.currentY = this.currentY;\r\n    }\r\n    else if (Math.abs(this.currentY) > max2) {\r\n      this.currentY = - max2;\r\n    }\r\n\r\n    this.countListIndex(this.currentY);\r\n\r\n    this.setState({\r\n      style: {\r\n        transform: `translate3d(0px, ${ this.currentY }px, 0px)`\r\n      }\r\n    });\r\n  }\r\n\r\n  handleTouchMove (e) {\r\n    if (this.props.data.list.length <= 1) {\r\n      return;\r\n    }\r\n    const pageY = e.nativeEvent.changedTouches[0].pageY;\r\n    let value = parseInt(pageY - this.startY);\r\n    const y = this.currentY + value;\r\n    let style = `translate3d(0px, ${ y }px, 0px)`;\r\n    this.setState({\r\n      style: {\r\n        transform: style\r\n      }\r\n    });\r\n  }\r\n\r\n  // 计算list数组索引\r\n  countListIndex (pageY) {\r\n    let n = pageY / this.itemHeight;\r\n    n = n > 0 ? 2 - n : Math.abs(n) + 2;\r\n    this.setSelectedValue(n);\r\n  }\r\n\r\n  // set选中值\r\n  setSelectedValue (index) {\r\n    const length = this.props.data.list.length;\r\n    if (length === 0) {\r\n      this.callback(null);\r\n      return;\r\n    }\r\n    if (index < 0 || index > length -1) {\r\n      throw new Error('滑动取值索引数值出现错误'+ index);\r\n    }\r\n    const value = this.props.data.list[index];\r\n    this.selectedIndex = index;\r\n\r\n    this.callback(value)\r\n  }\r\n\r\n  // 回调\r\n  callback (value) {\r\n    this.props.onChange(value);\r\n  }\r\n\r\n  getSelectedClass (index) {\r\n    if (this.selectedIndex === index) {\r\n      return 'ui-picker-item-selected';\r\n    }\r\n    return '';\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.setSelectedValue(this.selectedIndex);\r\n  }\r\n\r\n  render () {\r\n    const style = {\r\n      transform: this.getInitialStyle()\r\n    }\r\n    return (\r\n      <div className=\"ui-picker-wrapper\">\r\n          <div className=\"ui-picker\"\r\n            style = {this.state.style.transform ? this.state.style : style}\r\n            onTouchStart={this.handleTouchStart.bind(this)}\r\n            onTouchMove={this.handleTouchMove.bind(this)}\r\n            onTouchEnd = {this.handleTouchEnd.bind(this)}>\r\n            {\r\n              this.props.data.list.map((data, index) => {\r\n\r\n                const displayValue = this.props.data.displayValue(data);\r\n                return <div key={index}\r\n                  className={ 'ui-picker-item ' + this.getSelectedClass(index)}>\r\n                  {displayValue}\r\n                </div>\r\n              })\r\n            }\r\n          </div>\r\n          <div className=\"ui-picker-center\"></div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nPicker.propTypes = {\r\n  // 数据源\r\n  data: React.PropTypes.object.isRequired,\r\n  // 当停止滑动选中立即回调onchange方法\r\n  onChange: React.PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Picker;\r\n"]}